<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bon d'Intervention - CEP (Admin)</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a365d;
            --primary-light: #2c5282;
            --accent: #f6ad55;
            --accent-dark: #dd6b20;
            --bg: #f7fafc;
            --card: #ffffff;
            --text: #2d3748;
            --text-light: #718096;
            --border: #e2e8f0;
            --success: #48bb78;
            --danger: #fc8181;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); min-height: 100vh; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .header { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; padding: 30px; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .logo-section h1 { font-size: 1.5rem; font-weight: 700; }
        .logo-section p { font-size: 0.9rem; opacity: 0.9; margin-top: 4px; }
        .bon-number { background: rgba(255,255,255,0.15); padding: 12px 20px; border-radius: 10px; text-align: right; }
        .bon-number span { font-family: 'Space Mono', monospace; font-size: 1.3rem; font-weight: 700; }
        .bon-number p { font-size: 0.8rem; opacity: 0.8; }
        .form-body { background: var(--card); padding: 30px; border: 1px solid var(--border); border-top: none; }
        .section { margin-bottom: 30px; }
        .section-title { font-size: 1.1rem; font-weight: 600; color: var(--primary); margin-bottom: 15px; padding-bottom: 8px; border-bottom: 2px solid var(--accent); display: flex; align-items: center; gap: 10px; }
        .section-title::before { content: ''; width: 4px; height: 20px; background: var(--accent); border-radius: 2px; }
        .input-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
        .input-group { display: flex; flex-direction: column; gap: 6px; }
        .input-group label { font-size: 0.85rem; font-weight: 500; color: var(--text-light); margin-bottom: 6px; }
        .input-group input, .input-group textarea, .input-group select { padding: 12px 14px; border: 2px solid var(--border); border-radius: 10px; font-family: inherit; font-size: 1rem; transition: all 0.2s ease; background: white; }
        .input-group input:focus, .input-group textarea:focus, .input-group select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(26, 54, 93, 0.1); }
        
        /* S√©lecteur de mat√©riel */
        .material-selector { background: #f0f7ff; border: 2px solid var(--primary); border-radius: 12px; padding: 15px; margin-bottom: 20px; }
        .material-selector label { font-weight: 600; color: var(--primary); margin-bottom: 10px; display: block; }
        .material-selector-row { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
        .material-selector select { flex: 1; min-width: 200px; padding: 12px; border: 2px solid var(--border); border-radius: 8px; font-size: 1rem; background: white; }
        .material-selector input[type="number"] { width: 80px; padding: 12px; border: 2px solid var(--border); border-radius: 8px; text-align: center; font-family: 'Space Mono', monospace; }
        .material-selector .btn-add { padding: 12px 20px; background: var(--success); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        .material-selector .btn-add:hover { background: #38a169; transform: scale(1.05); }

        .category-section { margin-bottom: 20px; }
        .category-header { background: var(--primary); color: white; padding: 10px 15px; border-radius: 8px 8px 0 0; font-weight: 600; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; }
        .category-header:hover { background: var(--primary-light); }
        .category-header .toggle-icon { transition: transform 0.3s; }
        .category-header.collapsed .toggle-icon { transform: rotate(-90deg); }
        .category-content { border: 1px solid var(--border); border-top: none; border-radius: 0 0 8px 8px; overflow: hidden; }
        .category-content.hidden { display: none; }
        /* Version admin : affichage complet avec prix et totaux */
        .product-row { display: grid; grid-template-columns: 40px 1fr 90px 80px 90px; align-items: center; padding: 10px 15px; border-bottom: 1px solid var(--border); transition: background 0.2s; }
        .product-row:last-child { border-bottom: none; }
        .product-row:hover { background: #f8fafc; }
        .product-row.selected { background: #ebf8ff; }
        .product-row input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; accent-color: var(--primary); }
        .product-name { font-size: 0.85rem; }
        .product-ref { font-size: 0.7rem; color: var(--text-light); font-family: 'Space Mono', monospace; }
        .product-price { font-weight: 600; color: var(--primary); text-align: center; font-size: 0.85rem; }
        .product-qty input { width: 55px; padding: 5px; text-align: center; border: 2px solid var(--border); border-radius: 6px; font-family: 'Space Mono', monospace; }
        .product-total { font-weight: 700; color: var(--accent-dark); text-align: right; font-family: 'Space Mono', monospace; font-size: 0.9rem; }

        .service-row { display: grid; grid-template-columns: 1fr 120px 120px 120px; align-items: center; padding: 15px; background: #fffaf0; border: 2px solid var(--accent); border-radius: 10px; margin-bottom: 10px; gap: 10px; }
        /* Ajuster la grille pour Main d'≈ìuvre (sans demi-heures ni tarif unitaire) */
        .service-row:has(#moDemiHeures[style*="display: none"]) {
            grid-template-columns: 1fr 150px 120px;
        }
        .service-row label { font-weight: 600; }
        .service-row input { padding: 8px; border: 2px solid var(--border); border-radius: 6px; font-family: 'Space Mono', monospace; text-align: center; }

        .totals-section { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; padding: 25px; border-radius: 12px; margin-top: 20px; }
        .total-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 1rem; }
        .total-row.grand-total { font-size: 1.4rem; font-weight: 700; border-top: 2px solid rgba(255,255,255,0.3); padding-top: 15px; margin-top: 10px; }
        .total-row span:last-child { font-family: 'Space Mono', monospace; }

        .signature-section { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-top: 30px; }
        .signature-box { border: 2px dashed var(--border); border-radius: 12px; padding: 20px; text-align: center; }
        .signature-box h4 { font-size: 0.9rem; color: var(--text-light); margin-bottom: 15px; }
        .signature-canvas { width: 100%; height: 120px; border: 2px solid var(--border); border-radius: 8px; background: white; cursor: crosshair; touch-action: none; }
        .signature-actions { margin-top: 10px; }
        .btn-clear { padding: 6px 12px; font-size: 0.8rem; background: var(--danger); color: white; border: none; border-radius: 6px; cursor: pointer; }

        .actions { display: flex; gap: 15px; margin-top: 30px; flex-wrap: wrap; }
        .btn { flex: 1; min-width: 200px; padding: 16px 30px; font-size: 1rem; font-weight: 600; border: none; border-radius: 12px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-primary { background: linear-gradient(135deg, var(--accent) 0%, var(--accent-dark) 100%); color: white; box-shadow: 0 4px 15px rgba(246, 173, 85, 0.4); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(246, 173, 85, 0.5); }
        .btn-secondary { background: var(--card); color: var(--primary); border: 2px solid var(--primary); }
        .btn-secondary:hover { background: var(--primary); color: white; }
        .btn-email { padding: 8px 12px; font-size: 0.8rem; font-weight: 500; border-radius: 8px; border: 1px solid var(--primary); background: var(--card); color: var(--primary); cursor: pointer; align-self: flex-start; }
        .btn-email:hover { background: var(--primary); color: #fff; }
        .photos-preview-admin { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
        .photos-preview-admin img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 1px solid var(--border); cursor: pointer; }
        .photo-thumb-admin { position: relative; display: inline-block; }
        .photo-remove-admin { position: absolute; top: -6px; right: -6px; background: rgba(0,0,0,0.7); color: #fff; border: none; border-radius: 999px; width: 18px; height: 18px; font-size: 11px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .photo-lightbox { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .photo-lightbox.show { display: flex; }
        .photo-lightbox img { max-width: 90vw; max-height: 90vh; border-radius: 8px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .photo-lightbox-close { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.7); color: #fff; border: none; border-radius: 999px; width: 32px; height: 32px; font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .material-search { padding: 8px 10px; border: 2px solid var(--border); border-radius: 8px; font-size: 0.9rem; min-width: 180px; }

        .footer { background: var(--primary); color: white; padding: 20px 30px; border-radius: 0 0 16px 16px; text-align: center; font-size: 0.85rem; }

        @media (max-width: 768px) {
            .product-row { grid-template-columns: 30px 1fr 60px 70px; }
            .service-row { grid-template-columns: 1fr 1fr; }
            .signature-section { grid-template-columns: 1fr; }
            .header { flex-direction: column; text-align: center; }
            .bon-number { text-align: center; }
            .material-selector-row { flex-direction: column; }
            .material-selector select, .material-selector input[type="number"] { width: 100%; }
        }
        @media print {
            body { padding: 0; background: white; }
            .btn, .actions, .btn-clear, .material-selector { display: none !important; }
            .header, .footer, .totals-section { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-section">
                <h1>‚ö° Compagnie d'√âlectricit√© Parisienne</h1>
                <p>Bon d'Intervention (Admin)</p>
            </div>
            <div class="bon-number">
                <span id="bonNumber">CEP-2024-0001</span>
                <p id="currentDate"></p>
            </div>
        </div>

        <div class="form-body">
            <div class="section">
                <h3 class="section-title">Informations Client</h3>
                <div class="input-grid">
                    <div class="input-group"><label>Nom / Soci√©t√©</label><input type="text" id="clientName" placeholder="Nom du client"></div>
                    <div class="input-group"><label>T√©l√©phone</label><input type="tel" id="clientPhone" placeholder="06 12 34 56 78"></div>
                    <div class="input-group">
                        <label>Email</label>
                        <input type="email" id="clientEmail" placeholder="email@exemple.fr">
                        <button type="button" class="btn-email" onclick="envoyerClient()">Envoyer au client</button>
                    </div>
                    <div class="input-group"><label>Adresse</label><input type="text" id="clientAddress" placeholder="Adresse compl√®te"></div>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">D√©tails de l'Intervention</h3>
                <div class="input-grid">
                    <div class="input-group"><label>Date</label><input type="date" id="interventionDate"></div>
                    <div class="input-group">
                        <label>Technicien</label>
                        <select id="technicien">
                            <option value="">-- S√©lectionner un technicien --</option>
                            <option value="Christophe Tavares">Christophe Tavares</option>
                            <option value="Ricardo Dassilva">Ricardo Dassilva</option>
                            <option value="Mathieu Rodriguez">Mathieu Rodriguez</option>
                        </select>
                    </div>
                    <div class="input-group" style="display: flex; flex-direction: column; gap: 0;">
                        <div style="display: flex; flex-direction: column; gap: 6px;">
                            <label>üïê Heure d'arriv√©e</label>
                            <input type="time" id="heureArrivee" onchange="calculerMainOeuvre()">
                        </div>
                        <div style="display: flex; flex-direction: column; gap: 6px; margin-top: 15px;">
                            <label>üïê Heure de d√©part</label>
                            <input type="time" id="heureDepart" onchange="calculerMainOeuvre()">
                        </div>
                    </div>
                    <div class="input-group" style="grid-column: 1 / -1;">
                        <label>Description</label>
                        <textarea id="description" rows="2" placeholder="Travaux effectu√©s..."></textarea>
                        <div style="margin-top:6px;">
                            <strong style="font-size:0.8rem; color:var(--text-light);">Photos de l'intervention</strong>
                            <div id="photosAdmin" class="photos-preview-admin">
                                <p style="color:var(--text-light); margin-top:4px;">Aucune photo pour ce bon.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">Produits Utilis√©s</h3>
                
                <!-- S√©lecteur rapide de mat√©riel -->
                <div class="material-selector">
                    <label>‚ö° Ajout rapide de mat√©riel</label>
                    <div class="material-selector-row">
                        <input type="text" id="materialSearchAdmin" class="material-search" placeholder="Rechercher un produit..." oninput="filterMaterialsAdmin()">
                        <select id="materialSelect">
                            <option value="">-- Choisir un produit --</option>
                            <optgroup label="üîå C√¢bles">
                                <option value="0" data-price="0.6">3G0,75 - 0.60‚Ç¨/m</option>
                                <option value="1" data-price="1.3">3G1,5 - 1.30‚Ç¨/m</option>
                                <option value="2" data-price="2">3G2,5 - 2.00‚Ç¨/m</option>
                                <option value="3" data-price="2.1">5G1,5 - 2.10‚Ç¨/m</option>
                                <option value="4" data-price="3.2">5G2,5 - 3.20‚Ç¨/m</option>
                                <option value="5" data-price="4.5">5G6 - 4.50‚Ç¨/m</option>
                                <option value="6" data-price="14">5G10 - 14‚Ç¨/m</option>
                                <option value="7" data-price="22">5G16 - 22‚Ç¨/m</option>
                                <option value="8" data-price="50">4X35 - 50‚Ç¨/m</option>
                                <option value="9" data-price="3">3G1,5 Pyrolion - 3‚Ç¨/m</option>
                                <option value="10" data-price="4.35">3G2,5 Pyrolion - 4.35‚Ç¨/m</option>
                                <option value="11" data-price="6.5">5G2,5 Pyrolion - 6.50‚Ç¨/m</option>
                                <option value="12" data-price="1.8">C√¢ble Info Cat.6 - 1.80‚Ç¨/m</option>
                                <option value="13" data-price="3.4">C√¢ble Sono 2X1,5 - 3.40‚Ç¨/m</option>
                                <option value="14" data-price="1">Gaine Grise √ò20 - 1‚Ç¨/m</option>
                            </optgroup>
                            <optgroup label="üîß Disjoncteurs Mono">
                                <option value="15" data-price="37">2A Mono 6kA - 37‚Ç¨</option>
                                <option value="16" data-price="39">4A Mono 6kA - 39‚Ç¨</option>
                                <option value="17" data-price="34">10A Mono 6kA - 34‚Ç¨</option>
                                <option value="18" data-price="34">16A Mono 6kA - 34‚Ç¨</option>
                                <option value="19" data-price="34">20A Mono 6kA - 34‚Ç¨</option>
                                <option value="20" data-price="37">32A Mono 6kA - 37‚Ç¨</option>
                            </optgroup>
                            <optgroup label="üîß Disjoncteurs T√©tra">
                                <option value="21" data-price="114">10A T√©tra 6kA - 114‚Ç¨</option>
                                <option value="22" data-price="114">16A T√©tra 6kA - 114‚Ç¨</option>
                                <option value="23" data-price="114">20A T√©tra 6kA - 114‚Ç¨</option>
                                <option value="24" data-price="130">32A T√©tra 6kA - 130‚Ç¨</option>
                                <option value="25" data-price="158">40A T√©tra 6kA - 158‚Ç¨</option>
                                <option value="26" data-price="275">63A T√©tra 10kA - 275‚Ç¨</option>
                            </optgroup>
                            <optgroup label="üîå Appareillages Plexo">
                                <option value="27" data-price="15">Inter. Plexo Saillie - 15‚Ç¨</option>
                                <option value="28" data-price="22">Prise Plexo Simple - 22‚Ç¨</option>
                                <option value="29" data-price="42">Prise Plexo Double - 42‚Ç¨</option>
                                <option value="30" data-price="86">Prise Plexo Triple - 86‚Ç¨</option>
                                <option value="31" data-price="72">Prise T√©tra 20A - 72‚Ç¨</option>
                                <option value="32" data-price="25">Fiche T√©tra 20A - 25‚Ç¨</option>
                                <option value="33" data-price="8">Bo√Æte Plexo √ò60 - 8‚Ç¨</option>
                                <option value="34" data-price="12">Bo√Æte Plexo √ò80 - 12‚Ç¨</option>
                                <option value="35" data-price="27">Bo√Æte Plexo √ò100 - 27‚Ç¨</option>
                                <option value="36" data-price="30">Prise Encastr√© Simple - 30‚Ç¨</option>
                                <option value="37" data-price="59">Prise Encastr√© Double - 59‚Ç¨</option>
                                <option value="38" data-price="90">Prise Encastr√© Triple - 90‚Ç¨</option>
                                <option value="39" data-price="67">Prise T√©tra Encastr√© - 67‚Ç¨</option>
                            </optgroup>
                            <optgroup label="üö® BAES & Peignes">
                                <option value="40" data-price="130">BAES Legrand - 130‚Ç¨</option>
                                <option value="41" data-price="120">BAES URA ONE - 120‚Ç¨</option>
                                <option value="42" data-price="290">T√©l√©commande BAES - 290‚Ç¨</option>
                                <option value="43" data-price="42">Peigne Mono DT40 - 42‚Ç¨</option>
                                <option value="44" data-price="76">Peigne T√©tra IDT40 - 76‚Ç¨</option>
                                <option value="45" data-price="28">Peigne T√©tra IC60 - 28‚Ç¨</option>
                            </optgroup>
                            <optgroup label="üí° √âclairage & LED">
                                <option value="46" data-price="8">Ampoule E27 2W - 8‚Ç¨</option>
                                <option value="47" data-price="9">Ampoule E27 4W Dim - 9‚Ç¨</option>
                                <option value="48" data-price="125">Guirlande 12m - 125‚Ç¨</option>
                                <option value="49" data-price="9">Ampoule GU10 7W - 9‚Ç¨</option>
                                <option value="50" data-price="1.1">Douille GU10 - 1.10‚Ç¨</option>
                                <option value="51" data-price="28">Ruban LED COB480 - 28‚Ç¨/m</option>
                                <option value="52" data-price="7.6">Profil√© Alu - 7.60‚Ç¨/m</option>
                                <option value="53" data-price="7.2">Capot Blanc - 7.20‚Ç¨/m</option>
                                <option value="54" data-price="105">Transfo 24V 100W - 105‚Ç¨</option>
                            </optgroup>
                            <optgroup label="üéõÔ∏è Variateurs">
                                <option value="55" data-price="390">RVLED 250W - 390‚Ç¨</option>
                                <option value="56" data-price="430">RVLED 500W - 430‚Ç¨</option>
                                <option value="57" data-price="490">RVLED 1000W - 490‚Ç¨</option>
                                <option value="58" data-price="65">Potentiom√®tre - 65‚Ç¨</option>
                                <option value="59" data-price="8.5">Support Potentiom√®tre - 8.50‚Ç¨</option>
                            </optgroup>
                        </select>
                        <input type="number" id="materialQty" value="1" min="1" placeholder="Qt√©">
                        <button class="btn-add" onclick="addMaterial()">+ Ajouter</button>
                    </div>
                </div>
                
                <div class="category-section">
                    <div class="category-header collapsed" onclick="toggleCategory(this)"><span>üîå C√¢bles</span><span class="toggle-icon">‚ñº</span></div>
                    <div class="category-content hidden">
                        <div class="product-row" data-index="0"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">3G0,75</div></div><div class="product-price">0.60‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="0.6" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="1"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">3G1,5</div></div><div class="product-price">1.30‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="1.3" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="2"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">3G2,5</div></div><div class="product-price">2.00‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="2" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="3"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">5G1,5</div></div><div class="product-price">2.10‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="2.1" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="4"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">5G2,5</div></div><div class="product-price">3.20‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="3.2" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="5"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">5G6</div></div><div class="product-price">4.50‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="4.5" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="6"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">5G10</div></div><div class="product-price">14‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="14" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="7"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">5G16</div></div><div class="product-price">22‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="22" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="8"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">4X35</div></div><div class="product-price">50‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="50" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="9"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">3G1,5 Pyrolion</div></div><div class="product-price">3‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="3" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="10"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">3G2,5 Pyrolion</div></div><div class="product-price">4.35‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="4.35" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="11"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">5G2,5 Pyrolion</div></div><div class="product-price">6.50‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="6.5" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="12"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">C√¢ble Info Cat.6</div></div><div class="product-price">1.80‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="1.8" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="13"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">C√¢ble Sono 2X1,5</div></div><div class="product-price">3.40‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="3.4" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="14"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Gaine Grise √ò20</div></div><div class="product-price">1‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="1" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-header collapsed" onclick="toggleCategory(this)"><span>üîß Disjoncteurs Mono</span><span class="toggle-icon">‚ñº</span></div>
                    <div class="category-content hidden">
                        <div class="product-row" data-index="15"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">2A Mono 6kA</div><div class="product-ref">A9P22602</div></div><div class="product-price">37‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="37" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="16"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">4A Mono 6kA</div><div class="product-ref">A9P22604</div></div><div class="product-price">39‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="39" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="17"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">10A Mono 6kA</div><div class="product-ref">A9P22610</div></div><div class="product-price">34‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="34" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="18"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">16A Mono 6kA</div><div class="product-ref">A9P22616</div></div><div class="product-price">34‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="34" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="19"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">20A Mono 6kA</div><div class="product-ref">A9P22620</div></div><div class="product-price">34‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="34" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="20"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">32A Mono 6kA</div><div class="product-ref">A9P22632</div></div><div class="product-price">37‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="37" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-header collapsed" onclick="toggleCategory(this)"><span>üîß Disjoncteurs T√©tra</span><span class="toggle-icon">‚ñº</span></div>
                    <div class="category-content hidden">
                        <div class="product-row" data-index="21"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">10A T√©tra 6kA</div><div class="product-ref">A9P22710</div></div><div class="product-price">114‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="114" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="22"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">16A T√©tra 6kA</div><div class="product-ref">A9P22716</div></div><div class="product-price">114‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="114" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="23"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">20A T√©tra 6kA</div><div class="product-ref">A9P22720</div></div><div class="product-price">114‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="114" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="24"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">32A T√©tra 6kA</div><div class="product-ref">A9P22732</div></div><div class="product-price">130‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="130" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="25"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">40A T√©tra 6kA</div><div class="product-ref">A9P22740</div></div><div class="product-price">158‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="158" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="26"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">63A T√©tra 10kA</div><div class="product-ref">A9P24463</div></div><div class="product-price">275‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="275" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-header collapsed" onclick="toggleCategory(this)"><span>üîå Appareillages Plexo</span><span class="toggle-icon">‚ñº</span></div>
                    <div class="category-content hidden">
                        <div class="product-row" data-index="27"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Inter. Plexo Saillie</div><div class="product-ref">069711L</div></div><div class="product-price">15‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="15" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="28"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Prise Plexo Simple</div><div class="product-ref">069731L</div></div><div class="product-price">22‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="22" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="29"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Prise Plexo Double</div><div class="product-ref">069768L</div></div><div class="product-price">42‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="42" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="30"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Prise Plexo Triple</div><div class="product-ref">069680L</div></div><div class="product-price">86‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="86" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="31"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Prise T√©tra 20A</div><div class="product-ref">091657</div></div><div class="product-price">72‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="72" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="32"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Fiche T√©tra 20A</div><div class="product-ref">055637</div></div><div class="product-price">25‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="25" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="33"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Bo√Æte Plexo √ò60</div><div class="product-ref">092003</div></div><div class="product-price">8‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="8" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="34"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Bo√Æte Plexo √ò80</div><div class="product-ref">092013</div></div><div class="product-price">12‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="12" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="35"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Bo√Æte Plexo √ò100</div><div class="product-ref">092020</div></div><div class="product-price">27‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="27" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="36"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Prise Encastr√© Simple</div><div class="product-ref">069831L</div></div><div class="product-price">30‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="30" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="37"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Prise Encastr√© Double</div><div class="product-ref">069562L</div></div><div class="product-price">59‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="59" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="38"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Prise Encastr√© Triple</div><div class="product-ref">080053</div></div><div class="product-price">90‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="90" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="39"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Prise T√©tra Encastr√©</div><div class="product-ref">080051</div></div><div class="product-price">67‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="67" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-header collapsed" onclick="toggleCategory(this)"><span>üö® BAES & Peignes</span><span class="toggle-icon">‚ñº</span></div>
                    <div class="category-content hidden">
                        <div class="product-row" data-index="40"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">BAES Legrand</div><div class="product-ref">062525</div></div><div class="product-price">130‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="130" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="41"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">BAES URA ONE</div><div class="product-ref">111013V</div></div><div class="product-price">120‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="120" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="42"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">T√©l√©commande BAES</div><div class="product-ref">062520</div></div><div class="product-price">290‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="290" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="43"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Peigne Mono DT40</div><div class="product-ref">A9XPN624</div></div><div class="product-price">42‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="42" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="44"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Peigne T√©tra IDT40</div><div class="product-ref">A9XPP724</div></div><div class="product-price">76‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="76" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="45"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Peigne T√©tra IC60</div><div class="product-ref">R9PXH424</div></div><div class="product-price">28‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="28" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-header collapsed" onclick="toggleCategory(this)"><span>üí° √âclairage & LED</span><span class="toggle-icon">‚ñº</span></div>
                    <div class="category-content hidden">
                        <div class="product-row" data-index="46"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Ampoule E27 2W</div><div class="product-ref">716630</div></div><div class="product-price">8‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="8" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="47"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Ampoule E27 4W Dim</div><div class="product-ref">165458</div></div><div class="product-price">9‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="9" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="48"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Guirlande 12m</div></div><div class="product-price">125‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="125" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="49"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Ampoule GU10 7W</div></div><div class="product-price">9‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="9" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="50"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Douille GU10</div></div><div class="product-price">1.10‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="1.1" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="51"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Ruban LED COB480</div></div><div class="product-price">28‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="28" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="52"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Profil√© Alu</div></div><div class="product-price">7.60‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="7.6" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="53"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Capot Blanc</div></div><div class="product-price">7.20‚Ç¨/m</div><div class="product-qty"><input type="number" value="0" min="0" data-price="7.2" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="54"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Transfo 24V 100W</div></div><div class="product-price">105‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="105" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                    </div>
                </div>

                <div class="category-section">
                    <div class="category-header collapsed" onclick="toggleCategory(this)"><span>üéõÔ∏è Variateurs</span><span class="toggle-icon">‚ñº</span></div>
                    <div class="category-content hidden">
                        <div class="product-row" data-index="55"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">RVLED 250W</div></div><div class="product-price">390‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="390" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="56"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">RVLED 500W</div></div><div class="product-price">430‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="430" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="57"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">RVLED 1000W</div></div><div class="product-price">490‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="490" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="58"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Potentiom√®tre</div><div class="product-ref">1977</div></div><div class="product-price">65‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="65" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                        <div class="product-row" data-index="59"><input type="checkbox" onchange="updateTotal(this)"><div><div class="product-name">Support Potentiom√®tre</div><div class="product-ref">A9A15152</div></div><div class="product-price">8.50‚Ç¨</div><div class="product-qty"><input type="number" value="0" min="0" data-price="8.5" onchange="updateRowTotal(this)"></div><div class="product-total">0.00‚Ç¨</div></div>
                    </div>
                </div>
            </div>

            <!-- R√©cap produits ajout√©s (vue admin, comme c√¥t√© technicien) -->
            <div class="section">
                <h3 class="section-title">R√©capitulatif des produits ajout√©s</h3>
                <div id="selectedProductsListAdmin" style="font-size:0.9rem; border:1px solid var(--border); border-radius:8px; padding:10px 12px; background:#f8fafc;">
                    <p style="color:var(--text-light);">Aucun produit s√©lectionn√© pour le moment.</p>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">R√©capitulatif des produits ajout√©s</h3>
                <div id="selectedProductsListAdmin" style="font-size:0.9rem; border:1px solid var(--border); border-radius:8px; padding:10px 12px; background:#f8fafc;">
                    <p style="color:var(--text-light);">Aucun produit s√©lectionn√© pour le moment.</p>
                </div>
            </div>

            <div class="section">
                <h3 class="section-title">Main d'≈íuvre & D√©placement</h3>
                <div class="service-row">
                    <label>üîß Main d'≈ìuvre</label>
                    <input type="text" id="moDuree" value="0h00" readonly style="background:#f0f0f0; cursor:not-allowed;" placeholder="Dur√©e">
                    <input type="text" id="moDemiHeures" value="0 demi-heures" readonly style="background:#f0f0f0; cursor:not-allowed; text-align:center; display:none;" placeholder="Demi-heures">
                    <input type="number" id="moTarif" value="35" min="0" placeholder="‚Ç¨/demi-h" style="display:none;">
                    <div class="product-total" id="moTotal">0.00‚Ç¨</div>
                </div>
                <div class="service-row">
                    <label>üöó D√©placement</label>
                    <input type="number" id="deplKm" value="0" min="0" placeholder="Km" onchange="updateDepl()">
                    <input type="number" id="deplTarif" value="0.50" min="0" step="0.1" placeholder="‚Ç¨/km" onchange="updateDepl()">
                    <div class="product-total" id="deplTotal">0.00‚Ç¨</div>
                </div>
            </div>

            <div class="totals-section">
                <div class="total-row"><span>Sous-total Produits</span><span id="subtotalProduits">0.00‚Ç¨</span></div>
                <div class="total-row"><span>Main d'≈ìuvre</span><span id="subtotalMO">0.00‚Ç¨</span></div>
                <div class="total-row"><span>D√©placement</span><span id="subtotalDepl">0.00‚Ç¨</span></div>
                <div class="total-row"><span>Total HT</span><span id="totalHT">0.00‚Ç¨</span></div>
                <div class="total-row"><span>TVA (20%)</span><span id="totalTVA">0.00‚Ç¨</span></div>
                <div class="total-row grand-total"><span>TOTAL TTC</span><span id="totalTTC">0.00‚Ç¨</span></div>
            </div>

            <div class="signature-section">
                <div class="signature-box">
                    <h4>Signature Technicien</h4>
                    <canvas class="signature-canvas" id="signatureTech"></canvas>
                    <div class="signature-actions"><button class="btn-clear" onclick="clearSignature('signatureTech')">Effacer</button></div>
                </div>
                <div class="signature-box">
                    <h4>Signature Client</h4>
                    <canvas class="signature-canvas" id="signatureClient"></canvas>
                    <div class="signature-actions"><button class="btn-clear" onclick="clearSignature('signatureClient')">Effacer</button></div>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è Imprimer</button>
                <button class="btn btn-primary" onclick="saveBon()">üíæ Enregistrer le bon</button>
                <button class="btn btn-primary" onclick="envoyerCompta()">üìß Envoyer en Comptabilit√©</button>
            </div>
        </div>

            <!-- Historique des bons -->
            <div class="section">
                <h3 class="section-title">Historique des bons enregistr√©s</h3>
                <div style="overflow-x:auto;">
                    <table style="width:100%; border-collapse:collapse; font-size:0.9rem;">
                        <thead>
                            <tr style="background:#edf2f7;">
                                <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">Date</th>
                                <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">N¬∞ Bon</th>
                                <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">Client</th>
                                <th style="text-align:left; padding:8px; border-bottom:1px solid var(--border);">Technicien</th>
                                <th style="text-align:right; padding:8px; border-bottom:1px solid var(--border);">Total TTC</th>
                                <th style="text-align:center; padding:8px; border-bottom:1px solid var(--border); width:160px;">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="bonsTableBody">
                            <!-- rempli en JS -->
                        </tbody>
                    </table>
                </div>
            </div>

        <div class="footer">Compagnie d'√âlectricit√© Parisienne ‚Äî Bon d'intervention (Admin)</div>
    </div>

    <!-- Lightbox d'aper√ßu des photos -->
    <div id="photoLightbox" class="photo-lightbox" onclick="closePhotoLightbox()">
        <button type="button" class="photo-lightbox-close" onclick="closePhotoLightbox(); event.stopPropagation();">√ó</button>
        <img id="photoLightboxImg" src="" alt="Aper√ßu photo">
    </div>

    <!-- Firebase v8 (app + firestore + storage) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script>
        let currentBonId = null; // id du document Firestore courant
        let photosAdmin = [];

        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyAuX2gsGiRGqVbsk93y0wmwJOsT-RuEkE4",
            authDomain: "bon-d-intervention-cep.firebaseapp.com",
            projectId: "bon-d-intervention-cep",
            storageBucket: "bon-d-intervention-cep.firebasestorage.app",
            messagingSenderId: "323636987494",
            appId: "1:323636987494:web:0b07cffbb086c767320fa7"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Utilise le m√™me compteur que la page technicien si besoin de cr√©er un nouveau bon vierge
        function getNextBonNumberFromStorage() {
            const today = new Date();
            const year = today.getFullYear();
            let lastYear = parseInt(localStorage.getItem('cep_lastBonYear') || '0', 10);
            let lastSeq = parseInt(localStorage.getItem('cep_lastBonSeq') || '0', 10);

            if (lastYear !== year) {
                lastYear = year;
                lastSeq = 0;
            }
            lastSeq += 1;

            localStorage.setItem('cep_lastBonYear', String(lastYear));
            localStorage.setItem('cep_lastBonSeq', String(lastSeq));

            return 'CEP-' + lastYear + '-' + String(lastSeq).padStart(4, '0');
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Protection par code admin
            const code = prompt("Code administrateur :");
            if (code !== "CEP2024") {
                alert("Code incorrect. Retour √† la page technicien.");
                window.location.href = "index.html";
                return;
            }

            const today = new Date();
            document.getElementById('currentDate').textContent = today.toLocaleDateString('fr-FR');
            document.getElementById('interventionDate').valueAsDate = today;
            initSignature('signatureTech');
            initSignature('signatureClient');
            renderHistorique();
        });

        function toggleCategory(header) {
            header.classList.toggle('collapsed');
            header.nextElementSibling.classList.toggle('hidden');
        }

        function addMaterial() {
            const select = document.getElementById('materialSelect');
            const qtyInput = document.getElementById('materialQty');
            const index = select.value;
            const qty = parseInt(qtyInput.value) || 1;
            
            if (index === '') {
                alert('Veuillez s√©lectionner un produit');
                return;
            }
            
            const row = document.querySelector(`.product-row[data-index="${index}"]`);
            if (row) {
                const checkbox = row.querySelector('input[type="checkbox"]');
                const qtyField = row.querySelector('.product-qty input');
                const currentQty = parseInt(qtyField.value) || 0;
                
                qtyField.value = currentQty + qty;
                checkbox.checked = true;
                row.classList.add('selected');
                updateRowTotal(qtyField);

                // Ne plus ouvrir automatiquement les cat√©gories ni scroller :
                // l'admin peut v√©rifier via les champs et les totaux.
            }
            
            select.value = '';
            qtyInput.value = 1;
        }

        function updateRowTotal(input) {
            const row = input.closest('.product-row');
            const checkbox = row.querySelector('input[type="checkbox"]');
            const qty = parseFloat(input.value) || 0;
            const price = parseFloat(input.dataset.price) || 0;
            row.querySelector('.product-total').textContent = (qty * price).toFixed(2) + '‚Ç¨';
            checkbox.checked = qty > 0;
            row.classList.toggle('selected', qty > 0);
            calculateTotals();
        }

        function updateTotal(checkbox) {
            const row = checkbox.closest('.product-row');
            row.classList.toggle('selected', checkbox.checked);
            if (!checkbox.checked) {
                row.querySelector('.product-qty input').value = 0;
                row.querySelector('.product-total').textContent = '0.00‚Ç¨';
            }
            calculateTotals();
        }

        function calculerMainOeuvre() {
            const heureArrivee = document.getElementById('heureArrivee').value;
            const heureDepart = document.getElementById('heureDepart').value;
            
            if (!heureArrivee || !heureDepart) {
                document.getElementById('moDuree').value = '0h00';
                document.getElementById('moDemiHeures').value = '0 demi-heures';
                document.getElementById('moTotal').textContent = '0.00‚Ç¨';
                calculateTotals();
                return;
            }
            
            // Convertir les heures en minutes
            const [hArr, mArr] = heureArrivee.split(':').map(Number);
            const [hDep, mDep] = heureDepart.split(':').map(Number);
            const minutesArrivee = hArr * 60 + mArr;
            const minutesDepart = hDep * 60 + mDep;
            
            // Calculer la dur√©e en minutes
            let dureeMinutes = minutesDepart - minutesArrivee;
            
            // G√©rer le cas o√π le d√©part est le lendemain (apr√®s minuit)
            if (dureeMinutes < 0) {
                dureeMinutes += 24 * 60; // Ajouter 24 heures
            }
            
            // Convertir en heures et minutes pour l'affichage
            const heures = Math.floor(dureeMinutes / 60);
            const minutes = dureeMinutes % 60;
            document.getElementById('moDuree').value = heures + 'h' + String(minutes).padStart(2, '0');
            
            // Calculer le nombre de demi-heures (arrondi au demi-heure sup√©rieur)
            const demiHeures = Math.ceil(dureeMinutes / 30);
            document.getElementById('moDemiHeures').value = demiHeures + ' demi-heure' + (demiHeures > 1 ? 's' : '');
            
            // Calculer le total : nombre de demi-heures √ó 35‚Ç¨
            const tarifDemiHeure = 35;
            const totalMO = demiHeures * tarifDemiHeure;
            document.getElementById('moTotal').textContent = totalMO.toFixed(2) + '‚Ç¨';
            
            calculateTotals();
        }

        function updateMO() {
            // Cette fonction n'est plus utilis√©e, mais on la garde pour compatibilit√©
            calculerMainOeuvre();
        }

        function updateDepl() {
            const km = parseFloat(document.getElementById('deplKm').value) || 0;
            const t = parseFloat(document.getElementById('deplTarif').value) || 0;
            document.getElementById('deplTotal').textContent = (km * t).toFixed(2) + '‚Ç¨';
            calculateTotals();
        }

        function calculateTotals() {
            let sub = 0;
            document.querySelectorAll('.product-row').forEach(row => {
                if (row.querySelector('input[type="checkbox"]')?.checked) {
                    sub += parseFloat(row.querySelector('.product-total').textContent) || 0;
                }
            });
            const mo = parseFloat(document.getElementById('moTotal').textContent) || 0;
            const depl = parseFloat(document.getElementById('deplTotal').textContent) || 0;
            const ht = sub + mo + depl;
            const tva = ht * 0.2;
            document.getElementById('subtotalProduits').textContent = sub.toFixed(2) + '‚Ç¨';
            document.getElementById('subtotalMO').textContent = mo.toFixed(2) + '‚Ç¨';
            document.getElementById('subtotalDepl').textContent = depl.toFixed(2) + '‚Ç¨';
            document.getElementById('totalHT').textContent = ht.toFixed(2) + '‚Ç¨';
            document.getElementById('totalTVA').textContent = tva.toFixed(2) + '‚Ç¨';
            document.getElementById('totalTTC').textContent = (ht + tva).toFixed(2) + '‚Ç¨';

            // R√©cap produits pour l'admin (comme c√¥t√© technicien)
            const container = document.getElementById('selectedProductsListAdmin');
            if (container) {
                const lignes = [];
                document.querySelectorAll('.product-row').forEach(row => {
                    const checkbox = row.querySelector('input[type="checkbox"]');
                    const qtyInput = row.querySelector('.product-qty input');
                    const qty = parseFloat(qtyInput.value) || 0;
                    if (checkbox && checkbox.checked && qty > 0) {
                        const name = row.querySelector('.product-name')?.textContent || '';
                        const totalLigne = row.querySelector('.product-total')?.textContent || '';
                        lignes.push({ name, qty, total: totalLigne });
                    }
                });

                if (lignes.length === 0) {
                    container.innerHTML = "<p style=\"color:var(--text-light);\">Aucun produit s√©lectionn√© pour le moment.</p>";
                } else {
                    container.innerHTML = lignes.map(l => 
                        `<div style="display:flex; justify-content:space-between; padding:4px 0; border-bottom:1px dashed var(--border);">
                            <span>${l.name}</span>
                            <span style="font-family:'Space Mono', monospace;">Qt√© : ${l.qty} &nbsp; | &nbsp; ${l.total}</span>
                        </div>`
                    ).join("");
                }
            }
        }

        function initSignature(id) {
            const canvas = document.getElementById(id);
            const ctx = canvas.getContext('2d');
            let drawing = false;
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            ctx.strokeStyle = '#1a365d';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';

            function pos(e) {
                const r = canvas.getBoundingClientRect();
                const x = (e.clientX || e.touches[0].clientX) - r.left;
                const y = (e.clientY || e.touches[0].clientY) - r.top;
                return {x, y};
            }
            canvas.onmousedown = e => { drawing = true; ctx.beginPath(); ctx.moveTo(pos(e).x, pos(e).y); };
            canvas.onmousemove = e => { if (drawing) { ctx.lineTo(pos(e).x, pos(e).y); ctx.stroke(); } };
            canvas.onmouseup = canvas.onmouseout = () => drawing = false;
            canvas.ontouchstart = e => { e.preventDefault(); drawing = true; ctx.beginPath(); ctx.moveTo(pos(e).x, pos(e).y); };
            canvas.ontouchmove = e => { e.preventDefault(); if (drawing) { ctx.lineTo(pos(e).x, pos(e).y); ctx.stroke(); } };
            canvas.ontouchend = () => drawing = false;
        }

        function clearSignature(id) {
            const c = document.getElementById(id);
            c.getContext('2d').clearRect(0, 0, c.width, c.height);
        }

        function envoyerClient() {
            const email = (document.getElementById('clientEmail').value || '').trim();
            if (!email) {
                alert("Veuillez renseigner l'email du client avant d'envoyer.");
                return;
            }
            const bon = document.getElementById('bonNumber').textContent;
            const client = document.getElementById('clientName').value || 'Client';
            const subject = encodeURIComponent("Bon d'intervention " + bon + " - " + client);
            const body = encodeURIComponent(
                "Bonjour,\n\n" +
                "Veuillez trouver ci-joint le bon d'intervention " + bon + ".\n\n" +
                "Cordialement,\nCompagnie d'√âlectricit√© Parisienne"
            );
            window.location.href = "mailto:" + email + "?subject=" + subject + "&body=" + body;
        }

        async function envoyerCompta() {
            if (!currentBonId) {
                alert("Charge d'abord un bon avant de l'envoyer en comptabilit√©.");
                return;
            }

            try {
                // S'assurer que le bon a un num√©ro d√©finitif et est bien sauvegard√©
                await saveBon();

                // Mettre √† jour le statut en 'valid√©'
                await db.collection('bons').doc(currentBonId).update({ statut: 'valid√©' });

                const bon = document.getElementById('bonNumber').textContent;
                const client = document.getElementById('clientName').value || 'Client';
                const technicien = document.getElementById('technicien').value || 'Non sp√©cifi√©';
                const total = document.getElementById('totalTTC').textContent;
                const subject = encodeURIComponent("Bon " + bon + " - " + client);
                const body = encodeURIComponent("Bon: " + bon + "\nClient: " + client + "\nTechnicien: " + technicien + "\nTotal TTC: " + total);
                window.location.href = "mailto:compta@cep75.fr?subject=" + subject + "&body=" + body;

                await renderHistorique();
            } catch (e) {
                console.error(e);
                alert("Erreur lors de la validation / envoi √† la comptabilit√©.");
            }
        }

        // Filtre de recherche rapide dans l'ascenseur produits (admin)
        function filterMaterialsAdmin() {
            const term = (document.getElementById('materialSearchAdmin').value || '').toLowerCase();
            const select = document.getElementById('materialSelect');
            if (!select) return;
            Array.from(select.options).forEach(opt => {
                if (opt.value === '') {
                    opt.hidden = false;
                    return;
                }
                const text = opt.textContent.toLowerCase();
                opt.hidden = term && !text.includes(term);
            });
        }

        // --- Gestion de l'historique des bons (stockage local navigateur) ---

        async function saveBon() {
            if (!currentBonId) {
                alert("Pour l'admin : charge d'abord un bon existant depuis l'historique, puis modifie et enregistre.");
                return;
            }

            // Si le bon n'a pas encore de num√©ro d√©finitif (brouillon), on en g√©n√®re un ici
            let numeroActuel = document.getElementById('bonNumber').textContent || '';
            if (!numeroActuel || numeroActuel.startsWith('BROUILLON')) {
                numeroActuel = getNextBonNumberFromStorage();
                document.getElementById('bonNumber').textContent = numeroActuel;
            }

            const bon = {
                id: currentBonId,
                numero: numeroActuel,
                date: document.getElementById('interventionDate').value || new Date().toISOString().slice(0,10),
                client: document.getElementById('clientName').value || '',
                phone: document.getElementById('clientPhone').value || '',
                email: document.getElementById('clientEmail').value || '',
                address: document.getElementById('clientAddress').value || '',
                technicien: document.getElementById('technicien').value || '',
                description: document.getElementById('description').value || '',
                heureArrivee: document.getElementById('heureArrivee').value || '',
                heureDepart: document.getElementById('heureDepart').value || '',
                moDuree: document.getElementById('moDuree').value || '0h00',
                moDemiHeures: document.getElementById('moDemiHeures').value || '0 demi-heures',
                moTarif: document.getElementById('moTarif').value || '35',
                deplKm: document.getElementById('deplKm').value || '0',
                deplTarif: document.getElementById('deplTarif').value || '0',
                subtotalProduits: document.getElementById('subtotalProduits').textContent || '0.00‚Ç¨',
                subtotalMO: document.getElementById('subtotalMO').textContent || '0.00‚Ç¨',
                subtotalDepl: document.getElementById('subtotalDepl').textContent || '0.00‚Ç¨',
                totalHT: document.getElementById('totalHT').textContent || '0.00‚Ç¨',
                totalTVA: document.getElementById('totalTVA').textContent || '0.00‚Ç¨',
                totalTTC: document.getElementById('totalTTC').textContent || '0.00‚Ç¨',
                produits: []
            };

            // Sauvegarder les quantit√©s de produits s√©lectionn√©s
            document.querySelectorAll('.product-row').forEach(row => {
                const index = row.dataset.index;
                const qtyInput = row.querySelector('.product-qty input');
                const qty = parseFloat(qtyInput.value) || 0;
                if (qty > 0) {
                    const name = row.querySelector('.product-name')?.textContent || '';
                    bon.produits.push({ index, name, qty });
                }
            });

            try {
                await db.collection('bons').doc(currentBonId).update(bon);
                await renderHistorique();
                alert("Modifications enregistr√©es pour ce bon (Firestore).");
            } catch (e) {
                console.error(e);
                alert("Erreur lors de l'enregistrement du bon (Firestore).");
            }
        }

        async function renderHistorique() {
            const tbody = document.getElementById('bonsTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            try {
                const snap = await db.collection('bons').where('statut', '==', 'en_attente').get();
                const bons = [];
                snap.forEach(doc => {
                    const data = doc.data();
                    bons.push({ id: doc.id, ...data });
                });

                bons.sort((a, b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));

                bons.forEach(bon => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="padding:6px 8px; border-bottom:1px solid var(--border);">${bon.date}</td>
                    <td style="padding:6px 8px; border-bottom:1px solid var(--border); font-family:'Space Mono', monospace;">${bon.numero || ''}</td>
                    <td style="padding:6px 8px; border-bottom:1px solid var(--border);">${bon.client}</td>
                    <td style="padding:6px 8px; border-bottom:1px solid var(--border);">${bon.technicien}</td>
                    <td style="padding:6px 8px; border-bottom:1px solid var(--border); text-align:right;">${bon.totalTTC}</td>
                    <td style="padding:6px 8px; border-bottom:1px solid var(--border); text-align:center;">
                        <button style="margin-right:6px; padding:4px 8px; font-size:0.75rem;" onclick="chargerBon('${bon.id}')">Charger</button>
                        <button style="padding:4px 8px; font-size:0.75rem; background:#e53e3e; color:#fff; border:none; border-radius:4px;" onclick="supprimerBon('${bon.id}')">Supprimer</button>
                    </td>
                `;
                tbody.appendChild(tr);
                });
            } catch (e) {
                console.error(e);
                tbody.innerHTML = '<tr><td colspan="6" style="padding:8px; text-align:center; color:var(--text-light);">Erreur de chargement des bons.</td></tr>';
            }
        }

        async function chargerBon(id) {
            try {
                const doc = await db.collection('bons').doc(id).get();
                if (!doc.exists) {
                    alert("Bon introuvable.");
                    return;
                }
                const bon = doc.data();
                console.log('Bon charg√©:', bon);
                console.log('Produits:', bon.produits);
                console.log('Photos:', bon.photos);

                currentBonId = id;

            document.getElementById('bonNumber').textContent = bon.numero;
            document.getElementById('interventionDate').value = bon.date;
            document.getElementById('clientName').value = bon.client;
            document.getElementById('clientPhone').value = bon.phone;
            document.getElementById('clientEmail').value = bon.email;
            document.getElementById('clientAddress').value = bon.address;
            document.getElementById('technicien').value = bon.technicien;
            document.getElementById('description').value = bon.description;
            document.getElementById('heureArrivee').value = bon.heureArrivee || '';
            document.getElementById('heureDepart').value = bon.heureDepart || '';
            document.getElementById('moDuree').value = bon.moDuree || '0h00';
            document.getElementById('moDemiHeures').value = bon.moDemiHeures || '0 demi-heures';
            document.getElementById('moTarif').value = bon.moTarif || '35';
            // Recalculer la main d'≈ìuvre si les heures sont pr√©sentes
            if (bon.heureArrivee && bon.heureDepart) {
                calculerMainOeuvre();
            }
            document.getElementById('deplKm').value = bon.deplKm;
            document.getElementById('deplTarif').value = bon.deplTarif;

            // Remettre tous les produits √† z√©ro
            document.querySelectorAll('.product-row').forEach(row => {
                row.querySelector('input[type="checkbox"]').checked = false;
                const qtyInput = row.querySelector('.product-qty input');
                qtyInput.value = 0;
                row.querySelector('.product-total').textContent = '0.00‚Ç¨';
                row.classList.remove('selected');
            });

            // R√©appliquer les quantit√©s sauvegard√©es et ouvrir les cat√©gories concern√©es
            (bon.produits || []).forEach(p => {
                // Convertir l'index en string pour la correspondance avec data-index
                const indexStr = String(p.index);
                const row = document.querySelector(`.product-row[data-index="${indexStr}"]`);
                if (row) {
                    const qtyInput = row.querySelector('.product-qty input');
                    // Utiliser quantite au lieu de qty (coh√©rence avec saveBonTech)
                    const quantite = parseFloat(p.quantite || p.qty || 0);
                    qtyInput.value = quantite;
                    row.querySelector('input[type="checkbox"]').checked = quantite > 0;
                    row.classList.toggle('selected', quantite > 0);
                    updateRowTotal(qtyInput);

                    // Ouvrir la cat√©gorie pour que l'admin voie le produit install√©
                    const categoryContent = row.closest('.category-content');
                    if (categoryContent && categoryContent.classList.contains('hidden')) {
                        categoryContent.classList.remove('hidden');
                        const header = categoryContent.previousElementSibling;
                        if (header && header.classList.contains('collapsed')) {
                            header.classList.remove('collapsed');
                        }
                    }
                } else {
                    console.warn('Produit non trouv√© avec index:', p.index, p.nom);
                }
            });

            // Recalculer les totaux MO / d√©placement
            updateMO();
            updateDepl();
            calculateTotals();

            // Afficher les photos (thumbnails avec lightbox)
            const photosContainer = document.getElementById('photosAdmin');
            if (photosContainer) {
                const photos = bon.photos || [];
                photosAdmin = photos.slice(); // Sauvegarder pour la suppression
                if (!photos.length) {
                    photosContainer.innerHTML = '<p style="color:var(--text-light); margin-top:4px;">Aucune photo pour ce bon.</p>';
                } else {
                    photosContainer.innerHTML = photos.map((url, idx) =>
                        `<div class="photo-thumb-admin" data-index="${idx}">
                            <img src="${url}" alt="Photo intervention" onclick="openPhotoLightbox('${url.replace(/'/g, "\\'")}')" />
                            <button type="button" class="photo-remove-admin" onclick="removePhotoAdmin(${idx}); event.stopPropagation();">√ó</button>
                        </div>`
                    ).join("");
                }
            }
        } catch (e) {
            console.error(e);
            alert("Erreur lors du chargement du bon depuis Firestore.");
        }
        }

        async function supprimerBon(id) {
            if (!confirm("Supprimer ce bon de l'historique ?")) return;
            try {
                await db.collection('bons').doc(id).delete();
                if (currentBonId === id) currentBonId = null;
                await renderHistorique();
            } catch (e) {
                console.error(e);
                alert("Erreur lors de la suppression du bon.");
            }
        }

        function openPhotoLightbox(url) {
            const overlay = document.getElementById('photoLightbox');
            const img = document.getElementById('photoLightboxImg');
            if (!overlay || !img) return;
            img.src = url;
            overlay.classList.add('show');
        }

        function closePhotoLightbox() {
            const overlay = document.getElementById('photoLightbox');
            if (!overlay) return;
            overlay.classList.remove('show');
        }

        async function removePhotoAdmin(index) {
            if (index < 0 || index >= photosAdmin.length) return;
            if (!currentBonId) return;
            
            try {
                const url = photosAdmin[index];
                // Supprimer de Firebase Storage
                if (url && storage && storage.refFromURL) {
                    try {
                        await storage.refFromURL(url).delete();
                    } catch (e) {
                        console.warn('Erreur suppression Storage (ignor√©e)', e);
                    }
                }
                
                // Retirer de la liste
                photosAdmin.splice(index, 1);
                
                // Mettre √† jour dans Firestore
                await db.collection('bons').doc(currentBonId).update({
                    photos: photosAdmin
                });
                
                // R√©afficher les photos
                const photosContainer = document.getElementById('photosAdmin');
                if (photosContainer) {
                    if (!photosAdmin.length) {
                        photosContainer.innerHTML = '<p style="color:var(--text-light); margin-top:4px;">Aucune photo pour ce bon.</p>';
                    } else {
                        photosContainer.innerHTML = photosAdmin.map((url, idx) =>
                            `<div class="photo-thumb-admin" data-index="${idx}">
                                <img src="${url}" alt="Photo intervention" onclick="openPhotoLightbox('${url.replace(/'/g, "\\'")}')" />
                                <button type="button" class="photo-remove-admin" onclick="removePhotoAdmin(${idx}); event.stopPropagation();">√ó</button>
                            </div>`
                        ).join("");
                    }
                }
            } catch (e) {
                console.error('Erreur suppression photo', e);
                alert("Erreur lors de la suppression de la photo.");
            }
        }
    </script>
</body>
</html>


